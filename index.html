<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
 <link rel="icon" type="image/x-icon" href="image.png">
<title>Basavara Manager</title>

<style>
*{box-sizing:border-box;font-family:Arial}
body{margin:0;background:#f4f6f8}
.hidden{display:none}
.box{max-width:1200px;margin:15px auto;background:#fff;padding:15px;border-radius:10px}
h2{color:#2ecc71;margin-bottom:10px}
input,select,button{padding:8px;margin:4px}
button{background:#2ecc71;color:#fff;border:none;border-radius:5px;cursor:pointer}
button.red{background:#e74c3c}
button.blue{background:#3498db}
.top{display:flex;flex-wrap:wrap;gap:5px;align-items:center}
.table-wrap{overflow-x:auto}
table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{border:1px solid #ddd;padding:8px;text-align:center}
th{background:#2ecc71;color:#fff}
.ok{color:green;font-weight:bold}
.no{color:red;font-weight:bold}
.year{color:red;font-size:14px;margin-left:5px}

.payment-container{
 border:1px solid #ccc;
 padding:10px;
 margin-top:15px;
 border-radius:5px;
 background:#fff
}
.transaction{
 border:1px solid #ccc;
 padding:10px;
 margin-bottom:10px;
 cursor:pointer;
 background:#f9f9f9;
 border-radius:5px
}
.transaction:hover{background:#e0e0e0}

@media(max-width:600px){
 .top{flex-direction:column}
 button,input,select{width:100%}
 table{font-size:12px}
}
@media print{
 .top,button,#filter,#historyContainer{display:none}
}
.adv{
  
  display: flex;
  justify-content: center;
  align-items: center;
  margin: 100px;
  top: 0;
  position: absolute;
}
.popup-overlay{
  box-shadow: 0 0 1000px rgba(0, 0, 0, .3);
  height: 400px;
  width: 300px;
  background-color: #d0ece4;
  border: 7px solid green;
  display: none;
  border-radius: 10px;
  justify-content: center;
  align-items: center;
  text-align: center;
  top: 50px;
}
.popup-overlay a {
  background-color: #2ecc71;
  text-decoration: none;
  color: black;
  padding: 10px;
  position: relative;
}
.close-btn{
  padding: 20px;
  font-size: 30px;
  position: absolute;
  top: 0;
  right: 0;
  margin: 20px;
  background-color: #e74c3c;
  border-radius: 10px;
  cursor: pointer;
  border-radius: 20px;
}
</style>
</head>

<body>

<!-- LOGIN -->
<div class="box" id="loginBox">
<h2>Login</h2>
<input id="user" placeholder="Username">
<input id="pass" type="password" placeholder="Password">
<button onclick="login()">Login</button>
<p id="msg"></p>
</div>

<!-- APP -->
<div class="box hidden" id="app">
<h2 id="title">Basavara Manager <span class="year"></span></h2>

<div class="top">
<select id="lang" onchange="setLang()">
<option value="en">EN</option>
<option value="bn">BN</option>
</select>

<select id="month"></select>

<button onclick="addPerson()" id="addBtn">Add Bharatia</button>
<button onclick="exportCSV()" id="exBtn">Export CSV</button>
<button class="blue" onclick="printReport()">Print</button>

<input id="filter" placeholder="Filter name / flat / phone" onkeyup="draw()">

<button class="red" onclick="clearAllData()">Clear All Data</button>
<button class="red" onclick="logout()">Logout</button>
</div>
<a href="user-mannual.md"><button>How to use?</button></a>
<div class="table-wrap">
<table>
<thead>
<tr>
<th>Flat</th>
<th>Name</th>
<th>Rent (‡ß≥)</th>
<th>Paid (‡ß≥)</th>
<th>Due (‡ß≥)</th>
<th>Status</th>
<th>Action</th>
</tr>
</thead>
<tbody id="list"></tbody>
</table>
</div>

<h3 id="sumTitle">Summary</h3>
<ul id="summary"></ul>
<p><b>Total Rent:</b> ‡ß≥<span id="tRent">0</span></p>
<p><b>Total Paid:</b> ‡ß≥<span id="tPaid">0</span></p>
<p><b>Total Due:</b> ‡ß≥<span id="tDue">0</span></p>

<!-- PAYMENT HISTORY -->
<div id="historyContainer" class="payment-container hidden">
<h2>Payment History</h2>
<div id="paymentContainer"></div>
</div>

</div>

<div class="pofadv">
  <div class="adv">
   <div class="popup-overlay" id="popupOverlay">
        <div class="popup-content">
            <h2>Subscribe Our Channel</h2>
            <p>|Subscribe our channel NABHAN CRAFTS IDEAS and get more fuatures|</p>
            <br>
            <a href="https://www.youtube.com/@nabhans_crafts_ideas">Subscribe</a>
            <span class="close-btn" onclick="closePopup()">&times;</span>

        </div>
    </div>
</div>

</div>
<script>
/* LOGIN */
function login(){
 if(user.value==="aminul1234" && pass.value==="ami123@"){
  localStorage.setItem("login","1");
  loginBox.classList.add("hidden");
  app.classList.remove("hidden");
 } else msg.innerText="Wrong login";
}
function logout(){localStorage.removeItem("login");location.reload()}
if(localStorage.getItem("login")){
 loginBox.classList.add("hidden");app.classList.remove("hidden")
}

const popup = document.getElementById("popupOverlay");

// Show popup after page loads
window.addEventListener("load", () => {
    // Optional: show after 2 seconds
    setTimeout(() => {
        popup.style.display = "flex";
        
    }, 2000);
});

// Close popup function
function closePopup() {
    popup.style.display = "none";
}

// Close popup when clicking outside the content
popup.addEventListener("click", (e) => {
    if (e.target === popup) {
        closePopup();
    }
});

/* YEAR */
document.querySelector(".year").innerText=new Date().getFullYear()

/* MONTH */
const months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]
months.forEach(m=>month.innerHTML+=`<option>${m}</option>`)
month.selectedIndex=new Date().getMonth()
month.onchange=draw

/* DATA */
let data=JSON.parse(localStorage.getItem("rent"))||{}

/* ADD PERSON */
function addPerson(){
 let flat=prompt("Flat No"); if(!flat)return
 let name=prompt("Name"); if(!name)return
 let phone=prompt("Phone")
 let nid=prompt("NID")
 let father=prompt("Father Name")
 let mother=prompt("Mother Name")
 let address=prompt("Address")
 let rent=+prompt("Rent",0)

 months.forEach(m=>{
  if(!data[m])data[m]=[]
  data[m].push({flat,name,phone,nid,father,mother,address,rent,paid:0,history:[]})
 })
 save();draw()
}

/* DRAW */
function draw(){
 let m=month.value
 list.innerHTML="";summary.innerHTML=""
 let tr=0,tp=0
 if(!data[m])return
 let f=filter.value.toLowerCase()

 data[m].forEach((p,i)=>{
  if(!(p.name+p.flat+p.phone).toLowerCase().includes(f))return
  let due=p.rent-p.paid
  tr+=p.rent;tp+=p.paid
  list.innerHTML+=`
<tr>
<td>${p.flat}</td>
<td>${p.name}</td>
<td>${p.rent}</td>
<td>${p.paid}</td>
<td>${due}</td>
<td class="${due<=0?'ok':'no'}">${due<=0?'‚úîÔ∏è':'‚ùå'}</td>
<td>
<button onclick="pay(${i})">Pay</button>
<button class="blue" onclick="openHistory(${i})">History</button>
<button onclick="details(${i})">üë§</button>
<button onclick="edit(${i})">‚úèÔ∏è</button>
<button class="red" onclick="del(${i})">‚ùå</button>
</td>
</tr>`
 })

 data[m].forEach(p=>{
  let li=document.createElement("li")
  li.innerText=`Flat ${p.flat} | ${p.name} | Due ‡ß≥${p.rent-p.paid}`
  summary.appendChild(li)
 })

 tRent.innerText=tr
 tPaid.innerText=tp
 tDue.innerText=tr-tp
}

/* PAY */
function pay(i){
 let a=+prompt("Paid Amount")
 if(!a)return
 let p=data[month.value][i]
 p.paid+=a
 p.history.push({amount:a,date:new Date().toLocaleDateString()})
 save();draw();openHistory(i)
}

/* HISTORY */
function openHistory(i){
 let p=data[month.value][i]
 paymentContainer.innerHTML=""
 if(!p.history.length){
  paymentContainer.innerHTML="<p>No payment yet</p>"
 }else{
  p.history.forEach((x,n)=>{
   let d=document.createElement("div")
   d.className="transaction"
   d.innerText=`Transaction ${n+1} - ‡ß≥${x.amount}`
   d.onclick=()=>alert(`Amount: ‡ß≥${x.amount}\nDate: ${x.date}`)
   paymentContainer.appendChild(d)
  })
 }
 historyContainer.classList.remove("hidden")
}

/* DETAILS */
function details(i){
 let p=data[month.value][i]
 alert(
  `Name: ${p.name}
Flat: ${p.flat}
Phone: ${p.phone}
NID: ${p.nid}
Father: ${p.father}
Mother: ${p.mother}
Address: ${p.address}`
 )
}

/* EDIT / DELETE */
function edit(i){
 let r=+prompt("Edit Rent",data[month.value][i].rent)
 if(r>=0)data[month.value][i].rent=r
 save();draw()
}
function del(i){
 data[month.value].splice(i,1)
 save();draw()
}

/* CLEAR ALL DATA */
function clearAllData(){
 if(confirm("‚ö†Ô∏è ‡¶∏‡¶¨ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶∏‡ßç‡¶•‡¶æ‡ßü‡ßÄ‡¶≠‡¶æ‡¶¨‡ßá ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá!\n‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§?")){
  localStorage.removeItem("rent")
  alert("‡¶∏‡¶¨ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá")
  location.reload()
 }
}

/* SAVE */
function save(){localStorage.setItem("rent",JSON.stringify(data))}

/* EXPORT */
function exportCSV(){
 let m=month.value;if(!data[m])return
 let csv="Flat,Name,Phone,Rent,Paid,Due\n"
 data[m].forEach(p=>{
  csv+=`${p.flat},${p.name},${p.phone},${p.rent},${p.paid},${p.rent-p.paid}\n`
 })
 let a=document.createElement("a")
 a.href=URL.createObjectURL(new Blob([csv],{type:"text/csv"}))
 a.download=m+"_rent.csv";a.click()
}

/* PRINT */
function printReport(){window.print()}

/* LANGUAGE */
function setLang(){
 if(lang.value==="bn"){
  title.innerText="‡¶¨‡¶æ‡¶∏‡¶æ‡¶≠‡¶æ‡ßú‡¶æ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶æ‡¶∞"
  addBtn.innerText="‡¶≠‡¶æ‡ßú‡¶æ‡¶ü‡¶ø‡ßü‡¶æ ‡¶Ø‡ßã‡¶ó"
  exBtn.innerText="CSV ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶°"
  filter.placeholder="‡¶®‡¶æ‡¶Æ / ‡¶´‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶ü / ‡¶´‡ßã‡¶®"
  sumTitle.innerText="‡¶∏‡¶æ‡¶∞‡¶∏‡¶Ç‡¶ï‡ßç‡¶∑‡ßá‡¶™"
 }else location.reload()
}

draw()
</script>
</body>
</html>



